/*! thread.js - v0.1 - MIT License - https://github.com/h2non/thread.js */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.thread=e()}}(function(){var define,module,exports;return function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){var u=typeof require=="function"&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[o]={exports:{}};t[o][0].call(f.exports,function(e){var r=t[o][1][e];return i(r?r:e)},f,f.exports,e,t,r,n)}return r[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){var n=e("./utils");var i=e("./worker");var s=window.addEventListener?"addEventListener":"attachEvent";var o=s==="attachEvent"?"onmessage":"message";var a=window[s];t.exports=u;function u(e){this.listeners={};this.id=e;this._create();this._setupListeners();this._initialize()}u.prototype._create=function(){var e=this.iframe=document.createElement("iframe");if(!e.style)e.style={};e.style.display="none";e.id="thread-"+this.id;document.body.appendChild(e)};u.prototype._subscribeListeners=function(e){var t=this.listeners;if(s==="attachEvent")e="on"+e;a(e,function(r){if(r.data&&r.data.owner==="thread.js"){if(t[e]){n.each(t[e],function(e){e(r)})}}})};u.prototype._setupListeners=function(){this._subscribeListeners("message");this._subscribeListeners("error")};u.prototype._getWindow=function(){var e=this.iframe.contentWindow;var t=e.eval,r=e.execScript;if(!t&&r){r.call(e,"null");t=e.eval}return e};u.prototype._initialize=function(e){var t=this._getWindow();t.eval.call(t,n.getSource(i))};u.prototype.addEventListener=function(e,t){var r=this.listeners[e]=this.listeners[e]||[];r.push(t)};u.prototype.removeEventListener=function(e,t){var r=this.listeners[e];if(r){if(n.isFn(t)){r.splice(0,r.length)}else{var i=r.indexOf(t);if(~i){r.splice(i,1)}}}};u.prototype.postMessage=function(e){var t=this._getWindow();e.origin=c();t.postMessage(e,e.origin)};u.prototype.terminate=function(){this.listeners=null;document.body.removeChild(this.iframe)};function c(){return location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}},{"./utils":5,"./worker":6}],2:[function(e,t,r){var n=e("./thread");t.exports=i;function i(e){return new n(e)}i.VERSION="0.1.0";i.create=i;i.Task=n.Task;i.Thread=n},{"./thread":4}],3:[function(e,t,r){var n=e("./utils");t.exports=i;function i(e){this.id=n.generateUUID();this.thread=e;this.worker=e._worker;this.env={};this.memoized=null;this.listeners={error:[],success:[],end:[]};this._subscribe()}i.prototype._buildError=function(e){var t=new Error(e.error);t.name=e.errorName;t.stack=e.errorStack;return t};i.prototype._getValue=function(e){return e.type==="run:error"?this._buildError(e):e.value};i.prototype._trigger=function(e,t){(function r(t){var n=t.shift();if(n){n(e);if(t.length)r(t)}})(this.listeners[t])};i.prototype._subscribe=function(){var e=this;this.worker.addEventListener("message",t);function t(r){var n;var i=r.data;var s=i.type;var o=e.listeners;if(i&&i.id===e.id){if(s==="run:error"||s==="run:success"){e.worker.removeEventListener("message",t);e.memoized=r.data;i=e._getValue(i);e._trigger(i,s.split(":")[1]);e._trigger(i,"end")}}}};i.prototype.setEnv=function(e){n.extend(this.env,e);return this};i.prototype.run=function(e,t){var r=this;if(!n.isFn(e)){throw new TypeError("first argument must be a function")}var t=n.extend({},this.env,t);this.memoized=null;var i=this.thread.maxTaskDelay;if(i>250){var s=(new Date).getTime();var o=setInterval(function(){if(r.memoized){return clearInterval(o)}if((new Date).getTime()-s>i){var e=new Error("maximum task execution exceeded");r.memoized={type:"run:error",error:e};r._trigger(e,"error");r._trigger(e,"end");clearInterval(o)}},250)}this.worker.postMessage({id:this.id,type:"run",env:t,src:e.toString()});return this};i.prototype.then=function(e,t){if(n.isFn(e)){if(this.memoized){if(this.memoized.type==="run:success")e(this._getValue(this.memoized))}else{this.listeners.success.push(e)}}if(n.isFn(t)){this.catch(t)}return this};i.prototype.catch=function(e){if(n.isFn(e)){if(this.memoized){if(this.memoized.type==="run:error")e(this._getValue(this.memoized))}else{this.listeners.error.push(e)}}return this};i.prototype.finally=function(e){if(n.isFn(e)){if(this.memoized){e(this._getValue(this.memoized))}else{this.listeners.end.push(e)}}return this};i.prototype.flush=function(){this.memoized=this.worker=this.env=null};i.create=function(e){return new i(e)}},{"./utils":5}],4:[function(e,t,r){var n=e("./utils");var i=e("./worker");var s=e("./task");var o=e("./fake-worker");var a=window;var u=a.URL||a.webkitURL;var c=n.isFn(a.Worker);t.exports=f;function f(e){this.options={};this._terminated=false;this.maxTaskDelay=5*1e3;this.id=n.generateUUID();this._setOptions(e);this._create()}f.prototype._setOptions=function(e){this.options.namespace="env";this.options.require=[];this.options.env={};n.extend(this.options,e);return this};f.prototype._create=function(){var e,t=n.getSource(i);if(u){try{e=new Blob([t],{type:"text/javascript"})}catch(r){var s=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder;e=new s;e.append(t);e=e.getBlob()}e=u.createObjectURL(e)}if(c&&u){this._worker=new Worker(e)}else{this._worker=new o(this.id)}this.send(n.extend({type:"start"},this.options));this._worker.addEventListener("error",function(e){throw e});return this};f.prototype.require=function(e,t){if(n.isFn(e)){t=e;e=n.fnName(t);if(!e){throw new Error("Function must have a name")}this.send({type:"require:fn",src:t.toString(),name:n.fnName(t)})}else if(typeof e==="string"){if(n.isFn(t)){this.send({type:"require:fn",src:t.toString(),name:e})}else{this.send({type:"require:file",src:e})}}else if(n.isObj(e)){n.each(e,function(t,r){if(n.isFn(t)){e[r]=t.toString()}});this.send({type:"require:map",src:e})}};f.prototype.run=f.prototype.exec=function(e,t){var r;if(e instanceof s){r=e}else{r=new s(this)}n.defer(function(){r.run(e,t)});return r};f.prototype.bind=function(e){this.send({type:"env",data:e});return this};f.prototype.send=function(e){if(this._worker){this._worker.postMessage(e)}};f.prototype.terminate=f.prototype.kill=function(){if(!this._terminated){this.options={};this._terminated=true;this._worker.terminate()}return this};f.prototype.start=function(e){if(this._terminated){this._setOptions(e);this._terminated=false;this._create()}return this};f.Task=s},{"./fake-worker":1,"./task":3,"./utils":5,"./worker":6}],5:[function(e,t,r){var n=r;var i=Object.prototype.toString;r.isFn=function s(e){return typeof e==="function"};r.isObj=function o(e){return e&&i.call(e)==="[object Object]"};r.isArr=function a(e){return e&&i.call(e)==="[object Array]"};r.toArr=function u(e){return Array.prototype.slice.call(e)};r.defer=function c(e){setTimeout(e,1)};r.bind=function f(e,t){return function(){t.apply(e,arguments)}};r.each=function l(e,t){var r,i;if(n.isArr(e)){for(r=0,i=e.length;r<i;r+=1){t(e[r],r)}}else if(n.isObj(e)){for(r in e)if(e.hasOwnProperty(r)){t(e[r],r)}}};r.extend=function p(e){var t=n.toArr(arguments).slice(1);n.each(t,function(t){n.each(t,function(t,r){e[r]=t})});return e};r.clone=function d(e){return n.extend({},e)};r.getSource=function h(e){return"("+e.toString()+").call(this)"};r.fnName=function v(e){return e.name||/\W*function\s+([\w\$]+)\(/.exec(e.toString())[1]};r.generateUUID=function m(){var e=(new Date).getTime();var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t=="x"?r:r&7|8).toString(16)});return t}},{}],6:[function(require,module,exports){module.exports=worker;function worker(){var self=self||this;function evalExpr(expr){var fn=null;eval("fn = "+expr);return fn}(function isolated(){var namespace="env";var isWorker=self.document===undefined;var toStr=Object.prototype.toString;var eventMethod=self.addEventListener?"addEventListener":"attachEvent";var messageEvent=eventMethod==="attachEvent"?"onmessage":"message";var importFn=isWorker?importScripts:appendScripts;var ready=false;var queue,origin,scriptsLoad,intervalId=null;self.addEventListener=self[eventMethod];function isObj(e){return e&&toStr.call(e)==="[object Object]"}function isArr(e){return e&&Array.isArray?Array.isArray(e):toStr.call(e)==="[object Array]"}function each(e,t){var r,n;if(isArr(e)){if(e.forEach){e.forEach(t)}else{for(r=0,n=e.length;r<n;r+=1){t(e[r],r)}}}else if(isObj(e)){for(r in e)if(e.hasOwnProperty(r)){t(e[r],r)}}}function waitReady(){var e=self.document;if(e.readyState==="complete"){ready=true}else{self.document.onreadystatechange=function(){if(document.readyState==="complete"){ready=true}}}}function appendScript(e){var t=document.getElementsByTagName("head")[0];var r=document.createElement("script");r.type="text/javascript";r.src=e;scriptsLoad.push(r);r.onload=r.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){scriptsLoad.splice(scriptsLoad.indexOf(r),1)}r.onload=r.onreadystatechange=null};t.appendChild(r)}function appendScripts(){var e=Array.prototype.slice.call(arguments);for(var t=0;t<e.length;t+=1){if(e[t])appendScript(e[t])}}function scriptsLoadTimer(){intervalId=setInterval(function(){if(ready&&!scriptsLoad.length){clearInterval(intervalId);each(queue,function(e){e()});queue=[];intervalId=null}},50)}function loadScripts(e){if(isArr(e)){importFn.apply(self,e)}else{importFn(e)}if(!isWorker&&!intervalId){scriptsLoadTimer()}}function require(e){if(isArr(e)||typeof e==="string"){loadScripts(e)}else if(isObj(e)){each(e,function(e,t){requireFn(t,e)})}}function requireFn(name,fn){eval("self[namespace][name] = "+fn)}function postMessage(e){if(isWorker){self.postMessage(e)}else{e.owner="thread.js";self.parent.postMessage(e,origin)}}function sendError(e,t){postMessage({type:"run:error",id:e.id,error:t.message||t,errorName:t.name||null,errorStack:t.stack||null})}function sendSuccess(e,t){postMessage({type:"run:success",id:e.id,value:t})}function done(e){return function(t,r){if(t){sendError(e,t)}else{sendSuccess(e,r)}}}function process(e){var t=evalExpr(e.src);if(t.length>0){t.call(self,done(e))}else{t=t.call(self);sendSuccess(e,t)}}function run(e){function t(){try{process(e)}catch(t){sendError(e,t)}}if(!isWorker&&(!ready||scriptsLoad.length)){queue.push(t)}else{t()}}function start(e){if(e.require){require(e.require)}if(e.origin){origin=e.origin}namespace=e.namespace||namespace;self[namespace]=e.env||{}}function extendEnv(e){if(isObj(e.env)){extend(self[namespace],e.env)}}function onMessage(e){var t=e.data;if(t.origin){origin=t.origin}switch(t.type){case"start":start(t);break;case"run":run(t);break;case"env":extendEnv(t);break;case"require:fn":requireFn(t.name,t.src);break;case"require:file":case"require:map":require(t.src);break}}if(!isWorker){scriptsLoad=[];queue=[];waitReady()}self.addEventListener(messageEvent,onMessage);self.addEventListener("error",function(e){throw e})})()}},{}]},{},[2])(2)});